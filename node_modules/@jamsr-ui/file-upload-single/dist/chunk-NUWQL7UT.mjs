"use client"
import{b as I}from"./chunk-POF5S2MQ.mjs";import{a as O,b as V,c as B}from"./chunk-6OK5KFKR.mjs";import{useControlledState as ke,useIsDisabled as Ae}from"@jamsr-ui/hooks";import{FileAddIcon as Me}from"@jamsr-ui/shared-icons";import{useUIConfig as Oe}from"@jamsr-ui/config";import{cn as Ve,dataAttr as H,deepMergeProps as Be,mapPropsVariants as He,mergeGlobalProps as We}from"@jamsr-ui/utils";import{useCallback as s,useEffect as je,useMemo as _e,useRef as $e,useState as b}from"react";import{useDropzone as qe}from"react-dropzone";import{jsx as Xe}from"react/jsx-runtime";var so=W=>{let{fileUploadSingle:j={},globalConfig:_}=Oe(),h=W,$=We(j,h),q=Be($,h,_),[X,U]=He(q,I.variantKeys),{value:J,defaultValue:K,onValueChange:Q,onFileSelect:y,className:x,classNames:o,onError:F,onDelete:z,showDeleteBtn:Y=!0,description:Z="Choose a file or drag & drop it here",info:ee="Select images",dropzoneOptions:oe,fileSize:te,fileName:se,helperText:re,uploadIcon:ae=Xe(Me,{className:"shrink-0 text-inherit"}),getFileIcon:C,as:le,inputName:E,uploadApiUrl:G,onUploadSuccess:T,getFileUrlAfterUpload:w,label:ne,isFormControl:pe=!1,...L}=X,m=$e(null),[a=null,u]=ke(K,J,Q),{isDisabled:ie=!1}=U,{isDisabled:d,ref:ce}=Ae({isDisabled:ie,isFormControl:pe}),[n,f]=b(a),[de,g]=b(0),[me,P]=b(!1),[i,k]=b(null),ue=i?i.name:se,fe=i?i.size:te,ge=a&&V(a),Pe=le??"div",Ne=!n,ve=_e(()=>a?C?C?.(O(a)):B(a):"",[C,a]),c=s(()=>{n?.startsWith("blob:")&&URL.revokeObjectURL(n)},[n]);je(()=>{a!==n&&f(a)},[n,a]);let N=s(()=>{u(null),f(null),g(0),k(null),P(!1),c()},[c,u]),A=s(e=>{g(0),P(!1),m.current=null,c(),u(e),f(e)},[c,u]),S=s(()=>{g(0),P(!0),F?.({message:"Invalid response received",code:"INVALID_RESPONSE"})},[F]),M=s(e=>{e.stopPropagation(),z?.(),N(),m.current&&m.current.abort()},[z,N]),v=s(e=>{let l=new FormData;l.append(E,e);let r=new XMLHttpRequest;m.current=r,r.open("POST",G),r.upload.onprogress=p=>{if(p.lengthComputable){let D=Math.round(p.loaded/p.total*100);g(D)}},r.onload=()=>{if(r.status===200){let p=JSON.parse(r.responseText),D=w(p);A(D),T?.(p)}else S()},r.onerror=()=>{S()},r.onabort=()=>{N()},r.send(l)},[w,E,A,S,T,N,G]),be=s(e=>{e.preventDefault(),e.stopPropagation(),i&&v(i),P(!1)},[i,v]),Ue=s(e=>{let l=e[0];if(!l)return;k(l),c();let r=URL.createObjectURL(l);f(r),v(l),y?.(l)},[y,c,v]),{getRootProps:Fe,getInputProps:Ce,isDragActive:R}=qe({...oe,maxFiles:1,multiple:!1,disabled:d,onDrop:Ue,onDropRejected(e){e.forEach(l=>{let{errors:r}=l,p=r[0];p&&F?.(p)})}}),t=I({...U,isDisabled:d,isDragActive:R}),Se=s((e={})=>({"data-component":"file-upload","data-slot":"base","data-drag-active":H(R),"data-disabled":H(d),...e,...L,className:t.base({className:Ve(o?.base,x)})}),[x,o?.base,d,R,L,t]),Re=e=>({"data-slot":"label",...e,className:t.label({className:o?.label})}),De=s((e={})=>({"data-slot":"wrapper",...e,className:t.wrapper({className:o?.wrapper})}),[o?.wrapper,t]),Ie=s((e={})=>({"data-slot":"delete-btn",...e,onClick:M,className:t.deleteBtn({className:o?.deleteBtn})}),[o?.deleteBtn,M,t]),he=s((e={})=>({"data-slot":"picker",...e,className:t.picker({className:o?.picker})}),[o?.picker,t]),ye=s((e={})=>({"data-slot":"progress-overlay",...e,className:t.overlay({className:o?.overlay})}),[o?.overlay,t]),xe=s((e={})=>({"data-slot":"helper-text",...e,className:t.helperText({className:o?.helperText})}),[o?.helperText,t]),ze=s((e={})=>({"data-slot":"file-wrapper",...e,className:t.fileWrapper({className:o?.fileWrapper})}),[o?.fileWrapper,t]),Ee=s((e={})=>({"data-slot":"info",...e,className:t.info({className:o?.info})}),[o?.info,t]),Ge=s((e={})=>({"data-slot":"description",...e,className:t.description({className:o?.description})}),[o?.description,t]),Te=s((e={})=>({"data-slot":"image",...e,src:n??void 0,className:t.image({className:o?.image})}),[o?.image,n,t]),we=s((e={})=>({"data-slot":"file-name",...e,className:t.fileName({className:o?.fileName})}),[o?.fileName,t]),Le=s((e={})=>({"data-slot":"file-size",...e,className:t.fileSize({className:o?.fileSize})}),[o?.fileSize,t]);return{getBaseProps:Se,getRootProps:Fe,getInputProps:Ce,getLabelProps:Re,getDeleteBtnProps:Ie,getPickerProps:he,getOverlayProps:ye,getHelperTextProps:xe,getFileWrapperProps:ze,getInfoProps:Ee,getDescriptionProps:Ge,getImageProps:Te,Component:Pe,uploadIcon:ae,isAvatar:U.isAvatar,description:Z,info:ee,previewUrl:n,isImage:ge,getFileNameProps:we,getFileSizeProps:Le,fileName:ue,fileSize:fe,fileIcon:ve,showDeleteBtn:Y,isDisabled:d,progress:de,helperText:re,isEmpty:Ne,isFailed:me,onRetry:be,label:ne,inputRef:ce,getWrapperProps:De}};export{so as a};
