"use client"
import{b as R}from"./chunk-UNGEF6KL.mjs";import{autoUpdate as we,flip as Se,offset as ke,size as He,useDismiss as Ge,useFloating as Fe,useInteractions as Be,useListNavigation as Ke,useRole as Ue}from"@floating-ui/react";import{Chip as We}from"@jamsr-ui/chip";import{useUIConfig as $e}from"@jamsr-ui/config";import{useControlledState as oe}from"@jamsr-ui/hooks";import{cn as ne,deepMergeProps as _e,mapPropsVariants as je,mergeGlobalProps as ze}from"@jamsr-ui/utils";import{Children as qe,isValidElement as Je,useCallback as s,useMemo as A,useRef as L,useState as y}from"react";import{jsx as Qe}from"react/jsx-runtime";var pt=se=>{let{autocomplete:le={},globalConfig:re}=$e(),T=se,ae=ze(le,T),pe=_e(ae,T,re),[ue,I]=je(pe,R.variantKeys),d=L(null),{className:V,classNames:f,defaultOpen:ce,defaultValue:ie,isMultiple:o=!1,onOpenChange:me,onValueChange:de,open:fe,placement:D="bottom-start",value:ge,label:O,startContent:w,endContent:S,placeholder:k,helperText:H,isInvalid:G,children:g,inputProps:M,isDisabled:F,onBlur:B,errorMessage:K,onInputValueChange:U}=ue,W=L(null),[he,Ce]=y(1),[x,$]=y(!1),[l=[],r]=oe(ie,ge,de),c=qe.toArray(g).map(e=>Je(e)?{value:e.props.value,children:e.props.children,renderLabel:e.props.renderLabel,label:e.props.label??(typeof e.props.children=="string"?e.props.children:""),autocompleteItem:e}:null),h=s(e=>{if(o){let t=new Set(l);return t.has(e)?(t.delete(e),[...t]):(t.add(e),[...t])}return[e]},[o,l]),C=A(()=>{let e=Array.from(l);return o?e.map(t=>{let a=c.find(m=>m?.value===t),Oe=a?.renderLabel??a?.label??(typeof g=="string"?g:a?.value??"");return Qe(We,{onClick:m=>{m.stopPropagation(),m.nativeEvent.stopPropagation(),m.nativeEvent.stopImmediatePropagation()},onDelete:()=>r(h(t)),children:Oe},t)}):c.find(a=>a?.value===e[0])?.label??""},[c,g,h,o,r,l]),[_=!1,p]=oe(ce,fe,me),[i,P]=y(!o&&typeof C=="string"?C:""),Pe=c.filter(e=>e?.label.toLowerCase().includes(i.toLowerCase())),N=x?c:Pe,ve=N.map(e=>e?.autocompleteItem??null),[n,j]=y(null),z=L([]),u=R({className:V,...I}),q=s(e=>{P(e),U?.(e),p(!0),$(!1),j(0)},[U,p]),E=s(()=>{$(!0),p(e=>!e)},[p]),{refs:{setReference:J,setFloating:be},floatingStyles:ye,context:v}=Fe({placement:D,open:_,onOpenChange:E,whileElementsMounted:we,middleware:[ke(2),Se({crossAxis:D.includes("-"),padding:0}),He({apply({rects:e,elements:t,availableHeight:a}){Object.assign(t.floating.style,{maxHeight:`${Math.max(50,Math.min(400,a))}px`,width:`${e.reference.width}px`})},padding:0})]}),Ie=Ke(v,{listRef:z,activeIndex:n,selectedIndex:he,onNavigate:j,virtual:!0,loop:!0}),Me=Ge(v,{outsidePress:e=>{let t=e.target;return!(W.current?.contains(t)&&t?.dataset.slot==="label")}}),xe=Ue(v,{role:"listbox"}),{getReferenceProps:Q,getFloatingProps:Ne,getItemProps:X}=Be([Ie,Me,xe]),b=s(e=>{x&&n!==null&&Ce(n),o||(P(e.label),p(!1)),o&&(P(""),d.current?.focus()),r(h(e.value))},[n,h,x,o,p,r]),Y=s(()=>{d.current?.focus()},[]),Ee=s(e=>{e.preventDefault()},[]),Re=A(()=>({activeIndex:n,getItemProps:X,handleSelect:b,setValue:r,isMultiple:o,value:l,setInputValue:P,styles:u,focusInput:Y}),[n,X,b,o,r,u,l,Y]),Z=s(e=>{if(e.key==="Enter"&&n!==null){e.preventDefault();let t=N[n];if(!t)return;b({label:t.label,value:t.value})}},[n,b,N]),Ae=e=>({"data-component":"autocomplete","data-slot":"base",className:u.base({className:ne(f?.base,V)}),ref:W,...e}),Le=e=>({"data-slot":"popover",ref:be,style:ye,className:u.popover({className:f?.popover}),...Ne(),...e}),Te=e=>({"data-slot":"content",className:u.content({className:f?.content}),onMouseDown:Ee,...e}),Ve=e=>({"data-slot":"empty-content",className:u.emptyContent({className:f?.emptyContent}),...e}),ee=s(e=>{e.stopPropagation(),d.current?.focus(),r([])},[r]),te=A(()=>o?l.length>0:i.length>0,[i.length,o,l.length]),De=s(()=>({label:O,startContent:w,endContent:S,placeholder:k,helperText:H,errorMessage:K,isInvalid:G,radius:I.radius,...M,"data-slot":"input",value:i,onValueChange:q,type:"search",autoComplete:"off",children:o?C:null,inputWrapperRef:J,classNames:{...M?.classNames,inputWrapper:"select-none",contentWrapper:ne("h-auto flex-wrap gap-1",{"p-1":o})},isClearable:!0,onClearInput:ee,showClearButton:te,slotProps:{inputWrapper:{onClick:E}},isDisabled:F,onBlur:B,...Q({onKeyDown:Z,ref:d})}),[S,K,Q,q,Z,E,te,H,M,i,F,G,o,O,B,ee,k,C,J,w,I.radius]);return{context:v,elementsRef:z,isOpen:_,getBaseProps:Ae,getInputProps:De,getPopoverProps:Le,getContentProps:Te,contextValue:Re,childrenToRender:ve,getEmptyContentProps:Ve}};export{pt as a};
