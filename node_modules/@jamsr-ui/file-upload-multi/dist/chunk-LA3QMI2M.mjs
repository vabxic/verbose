"use client"
import{b as v}from"./chunk-TIYHFLKL.mjs";import{useUIConfig as Ne}from"@jamsr-ui/config";import{useControlledState2 as Ue,useIsDisabled as be}from"@jamsr-ui/hooks";import{FileAddIcon as ve}from"@jamsr-ui/shared-icons";import{cn as i,dataAttr as x,deepMergeProps as Fe,mapPropsVariants as Re,mergeGlobalProps as he,randomId as Ce}from"@jamsr-ui/utils";import{useCallback as n,useRef as Me}from"react";import{useDropzone as De}from"react-dropzone";import{jsx as Ie}from"react/jsx-runtime";var Te=w=>{let{fileUploadMulti:L={},globalConfig:O}=Ne(),F=w,T=he(L,F),V=Fe(T,F,O),[G,R]=Re(V,v.variantKeys),{defaultValue:A,value:k,className:N,classNames:o={},onFilesSelect:h,onValueChange:B,onError:d,showDeleteBtn:W=!0,dropzoneOptions:C={},onDelete:_,helperText:H,info:j,uploadIcon:z=Ie(ve,{className:"shrink-0 text-inherit"}),as:X,inputName:M,uploadApiUrl:D,onUploadSuccess:I,getFileUrlAfterUpload:y,label:$,isFormControl:q=!1,...E}=G,[p,m]=Ue(A??[],k,B),{isDisabled:J=!1}=R,{isDisabled:c,ref:K}=be({isDisabled:J,isFormControl:q}),g=Me([]),Y=X??"div",{maxFiles:u=5}=C,Q=p.length<u,f=n((e,r)=>{m(a=>a.map(t=>t.id===e?{...t,...r}:t))},[m]),U=n((e,r)=>{let a=new FormData;a.append(M,r);let t=new XMLHttpRequest;g.current.push({id:e,xhr:t}),t.open("POST",D),t.upload.onprogress=l=>{if(l.lengthComputable){let P=Math.round(l.loaded/l.total*100);f(e,{progress:P})}},t.onload=()=>{if(t.status===200){let l=JSON.parse(t.responseText),P=y(l),S=p.find(Pe=>Pe.id===e);S?.preview&&URL.revokeObjectURL(S.preview),f(e,{progress:"COMPLETE",file:null,preview:P}),I?.({id:e,response:l})}else f(e,{progress:"ERROR"}),d?.({message:"Invalid response received",code:"INVALID_RESPONSE"})},t.onerror=()=>{f(e,{progress:"ERROR"}),d?.({message:"Upload failed",code:"UPLOAD_FAILED"})},t.send(a)},[y,M,d,I,f,D,p]),Z=e=>{let r=p.find(a=>a.id===e);r?.file&&U(e,r.file)},ee=e=>{g.current.find(a=>a.id===e)?.xhr?.abort(),g.current=g.current.filter(a=>a.id!==e)},te=n(e=>{let r=e,a=u-p.length;if(u&&r.length>a){let l=`You can only upload ${u} files. Remaining ${a}`;d?.({message:l,code:"MAXIMUM_LIMIT_REACHED"});return}let t=r.map(l=>({preview:URL.createObjectURL(l),file:l,id:Ce(),progress:"PENDING"}));m(l=>[...l,...t]),t.forEach(l=>{l.file&&U(l.id,l.file)}),h?.(r)},[u,d,h,m,U,p]),{getRootProps:oe,getInputProps:se,isDragActive:b}=De({maxFiles:u,multiple:!0,disabled:c,onDrop:te,onDropRejected(e){e.forEach(r=>{let{errors:a}=r,t=a[0];t&&d?.(t)})},...C}),s=v({...R,isDisabled:c,isDragActive:b,className:N}),re=s.overlayWrapper({className:o.overlayWrapper}),ae=s.overlay({className:o.overlay}),le=(e,r)=>{_?.(r),ee(r),e.stopPropagation(),m(a=>a.filter(t=>t.id!==r))},ne=n(e=>({"data-component":"file-upload","data-slot":"base","data-drag-active":x(b),"data-disabled":x(c),...e,className:s.base({className:i(o?.base,N)}),...E}),[N,o?.base,c,b,s,E]),ie=e=>({"data-slot":"label",className:s.label({className:o?.label}),...e}),pe=n(e=>({"data-slot":"file-view",className:s.fileView({className:i(o?.fileView,e?.className)}),...e}),[o?.fileView,s]),ce=n(e=>({"data-slot":"file",className:s.file({className:i(o?.file,e?.className)}),...e}),[o?.file,s]),de=n(e=>({"data-slot":"delete-btn","aria-label":"delete",type:"button",disabled:c,className:s.deleteBtn({className:i(o?.deleteBtn,e?.className)}),...e}),[o?.deleteBtn,c,s]),me=n(e=>({"data-slot":"picker",className:s.picker({className:i(o?.picker,e?.className)}),...e}),[o?.picker,s]),ue=n(e=>({"data-slot":"helper-text",className:s.helperText({className:i(o?.helperText,e?.className)}),...e}),[o?.helperText,s]),fe=n(e=>({"data-slot":"inner-wrapper",className:s.innerWrapper({className:i(o?.innerWrapper,e?.className)}),...e}),[o?.innerWrapper,s]),ge=n(e=>({"data-slot":"info",className:s.info({className:i(o?.info,e?.className)}),...e}),[o?.info,s]);return{Component:Y,getRootProps:oe,getInputProps:se,getBaseProps:ne,getFileViewProps:pe,getFileProps:ce,getDeleteBtnProps:de,getPickerProps:me,handleDelete:le,value:p,setValue:m,showDeleteBtn:W,isDisabled:c,canUploadFile:Q,helperText:H,getHelperTextProps:ue,getInnerWrapperProps:fe,info:j,getInfoProps:ge,uploadIcon:z,retryUpload:Z,overlayWrapperClassName:re,overlayClassName:ae,label:$,getLabelProps:ie,inputRef:K}};export{Te as a};
